<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASTDX Update Log</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="perm_web_style.css">
  <link rel="stylesheet" href="temp_web_style.css">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@900&display=swap" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Cinzel' rel='stylesheet'>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

</head>
<body>
  <div id="loader-wrapper">
    <div id="loader-bar-container"><div id="loader-progress"></div></div>
    <p id="loader-text">Loading Assets...</p>
  </div>
  
  <div class="background-design"></div>

  <main>
    <section class="logo">
      <img id="logo_frame" src="assets/logo/images/ASTD_00000.png" alt="logo animation">
    </section>
    <section class="content-card">
      <div class="hiragana-background" translate="no">
        <div class="text-container">
          <!-- Layers are now generated by JavaScript -->
        </div>
      </div>
      
      <audio id="audio-player" src="assets/All Star Tower Defense Lobby Music (Roblox) [LaTale Music - May Be Happy].mp3" loop></audio>
      <div class="music-player"><button id="play-pause">▶</button></div>

      <div class="content-wrapper">
        <h1 class="main-header">ASTDX Update Log</h1>
        <p class="sub-text">Made by the ASTDX Questions Team</p>
        
        <div class="timeline-container">
          <div class="timeline-item">
            <div class="timeline-marker"></div>
            <div class="timeline-content">
              <h2 class="update-title">Update 6</h2>
              <p class="update-date">August XX 2025</p>

              <div class="changelog-layout">
                <div class="main-content-column">
                  <div class="content-box">
                    <h2>New Unit Additions</h2>
                    <div id="new-units-grid" class="unit-grid"></div>
                  </div>
                  <div class="content-box">
                    <h2>New Passives</h2>
                    <div id="new-passives-grid" class="unit-grid"></div>
                  </div>
              </div>
              <div id="unit-details-panel"></div>
            </div>
            <div class="content-box" style="margin-top:2rem;">
                    <h2>New Event: The Mafia</h2>
                    <p class="event-intro">Climb the ranks of the criminal underworld in this new event. Complete contracts to earn Rank EXP, Event Currency, and a chance to recruit powerful new allies.</p>
                    
                    <h3>The Ranks</h3>
                    <p>There are a Total of 10 Ranks to climb, with each Rank unlocking new Contracts and Special Bonuses:</p>
                    <ul class="rank-list">
                      <li class="boss">Boss</li> <li>Underboss</li> <li>Consigliere</li> <li>Capo</li> <li>Enforcer</li>
                      <li>Squad Leader</li> <li>Elite Member</li> <li>Member</li> <li>Associate</li> <li>Grunt</li>
                    </ul>

                    <h3>Contracts</h3>
                    <p>Polpo will show a dropdown list of Contracts for you to do. Some Contracts are locked behind being a specific Rank.</p>
                    
                    <div class="contracts-section">
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Grunt+ Missions</h3>
    </div>

    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>

      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Associate+ Missions</h3>
    </div>

    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>

      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Member+ & Elite Member+ Missions</h3>
    </div>

    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>

      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Squad Leader+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Squad Leader+ Mission</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Enforcer+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Enforcer+ Mission</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Capo+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Capo+ Missions</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Consigliere+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Consigliere+ Missions</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Underboss+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Underboss+ Missions</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>

  <!-- Boss+ -->
  <div class="contract-group">
    <div class="contract-group-header">
      <h3>Boss+ Mission</h3>
    </div>
    <ul class="contract-list">
      <li>
        <div class="contract-rank-label">Mission</div>
        <h4 class="contract-mission-name">Mission Name</h4>
        <div class="contract-meta">
          <div class="meta-required">Rank Required+</div>
          <div class="meta-refresh">Refresh: XX</div>
        </div>
        <p class="contract-desc">Insert Mission Description Here</p>
        <div class="contract-note">explain what to do to finish quest here filler text filler text filler text filler text filler text filler text filler text filler text </div>
      </li>
    </ul>
  </div>
</div>
                    
                    <hr class="event-divider">
                    <p class="event-summary">Your Mafia Rank can be leveled up by completing contracts, with harder contracts giving more Rank EXP and Event Currency. You can also get Rank EXP from general play or extra missions added to your Daily/Weekly Quests. With each Rank you obtain, the total currency from contracts will increase, and the chances to obtain Diavolo will also increase.</p>
                  </div>

                </div>
          </div>
        </div>

      </div>
    </section>
  </main>
  
  <script src="changelog-units.js"></script>
  
  <script>
    // --- START OF CONFIGURATION ---
    const newAdditionsFilter = ["Banana", "Banana 2"];
    const newPassivesFilter = ["Michishibo", "Spider Boss", "Supreme Leader", "Magma Marine", "Etri"];
    // --- END OF CONFIGURATION ---

    const loaderWrapper = document.getElementById('loader-wrapper');
    const loaderProgress = document.getElementById('loader-progress');
    const mainContent = document.querySelector('main');
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 5;
      if (progress > 99) { progress = 99; }
      loaderProgress.style.width = progress + '%';
    }, 100);

    const detailsPanel = document.getElementById('unit-details-panel');
    const placeholderHTML = `<div class="details-placeholder"><p>Click a unit to see details.</p></div>`;

    function generatePassiveHTML(passiveData) {
        if (typeof passiveData === 'string') { return `<p>${passiveData}</p>`; }
        
        // This new version maps each column to its own HTML block...
        const passiveBlocksHTML = passiveData.columns.map(col => {
            const contentHTML = col.content.map(line => `<p>${line}</p>`).join('');
            // We avoid using '.passive-column' to prevent the unwanted left border in a stacked layout.
            return `
                <div> 
                    ${col.heading ? `<h3>${col.heading}</h3>` : ''} 
                    <div class="passive-column-content">${contentHTML}</div>
                </div>
            `;
        // ...and then joins them with a styled horizontal rule (<hr>) to act as a divider.
        }).join('<hr style="border: 0; border-top: 1px solid var(--border-color); margin: 1.25rem 0;">'); 

        return `<strong>${passiveData.title || 'Passive Ability:'}</strong><div>${passiveBlocksHTML}</div>`;
    }

    function updateDetailsPanel(unitData) {
      if (!unitData) { detailsPanel.innerHTML = placeholderHTML; return; }
      const subheaderHTML = `<p class="details-subheader"><span class="rarity-${unitData.rarity.toLowerCase().replace(' ', '-')}">${unitData.rarity}</span> • <span class="subheader-placement">${unitData.placement}</span></p>`;
      const elementClass = `element-${unitData.element.toLowerCase()}`;
      const passiveHTML = generatePassiveHTML(unitData.passive);
      detailsPanel.innerHTML = `<div class="details-content-wrapper"><div class="details-header"><img id="details-unit-image" src="${unitData.image}" alt="${unitData.name}"><div class="details-title-group"><h2 id="details-unit-name">${unitData.name}</h2>${subheaderHTML}</div></div><div class="details-tags-container"><div class="details-tag tag-element ${elementClass}"><span>${unitData.element}</span></div><div class="details-tag tag-method"><span>${unitData.method}</span></div></div><div id="details-unit-passive">${passiveHTML}</div></div>`;
      anime({ targets: '.details-content-wrapper', opacity: [0, 1], translateY: [10, 0], duration: 500, easing: 'easeOutExpo' });
    }

    const startApp = () => {
      const mainContentColumn = document.querySelector('.main-content-column');
      const populateGrid = (gridId, filterList) => {
        const gridContainer = document.getElementById(gridId);
        if (!gridContainer) return;
        const filteredUnits = newUnitsData.filter(unit => filterList.includes(unit.name));
        if (filteredUnits.length > 0) {
          gridContainer.innerHTML = filteredUnits.map(unit => `<div class="unit-card" data-unit-name="${unit.name}"><img src="${unit.image}" alt="${unit.name}"><p>${unit.name}</p></div>`).join('');
        } else { gridContainer.innerHTML = "<p>No units for this category in this update.</p>"; }
      };
      
      populateGrid('new-units-grid', newAdditionsFilter);
      populateGrid('new-passives-grid', newPassivesFilter);
      updateDetailsPanel(null);

      function syncPanelHeight() {
        const mainContentColumn = document.querySelector('.main-content-column');
        const detailsPanel = document.getElementById('unit-details-panel');
        if (mainContentColumn && detailsPanel) {
          // Only apply this on wider screens where the layout is side-by-side
          if (window.innerWidth > 1200) {
            detailsPanel.style.maxHeight = `${mainContentColumn.offsetHeight}px`;
          } else {
            // On smaller screens, remove the max-height to allow natural flow
            detailsPanel.style.maxHeight = '';
          }
        }
      }
      // Sync on initial load and on resize
      syncPanelHeight();
      window.addEventListener('resize', syncPanelHeight);

      mainContentColumn.addEventListener('click', (event) => {
          const card = event.target.closest('.unit-card');
          if (!card) return;
          document.querySelectorAll('.unit-card.selected').forEach(selected => { selected.classList.remove('selected'); });
          card.classList.add('selected');
          const unitName = card.dataset.unitName;
          const unitData = newUnitsData.find(u => u.name === unitName);
          updateDetailsPanel(unitData);
      });

      const header = document.querySelector('.main-header');
      header.innerHTML = header.textContent.replace(/\S/g, "<span class='letter'>$&</span>");
      
      const tl = anime.timeline({ easing: 'easeOutExpo', duration: 750 });
      tl.add({ targets: '.main-header', opacity: [0, 1], duration: 200 })
        .add({ targets: '.main-header .letter', translateY: [20, 0], opacity: [0, 1], duration: 1200, delay: anime.stagger(50) }, '-=100')
        .add({ targets: '.sub-text', translateY: [15, 0], opacity: [0, 1], duration: 800 }, '-=1000')
        .add({ targets: ['.update-title', '.update-date'], translateY: [15, 0], opacity: [0, 1], delay: anime.stagger(100) }, '-=800')
        .add({ targets: ['.content-box', '#unit-details-panel'], translateY: [20, 0], opacity: [0, 1], delay: anime.stagger(100) }, '-=600')
        .add({ targets: '.unit-card', translateY: [15, 0], opacity: [0, 1], delay: anime.stagger(80) }, '-=800');
    };

    function initHiraganaBackground() {
      const textContainer = document.querySelector('.hiragana-background .text-container');
      if (!textContainer) return;

      const layersContent = [
        'あいうえおかきくけこさしすせそ',
        'タチツテトナニヌネノハヒフヘホ',
        'マミムメモヤユヨラリルレロ',
        'ワヲンアイウエオカキクケコサ',
        'あいうえおかきくけこさしすせそ',
        'タチツテトナニヌネノハヒフヘホ',
        'マミムメモヤユヨラリルレロ',
        'ワヲンアイウエオカキクケコサ',
        'あいうえおかきくけこさしすせそ',
      ];

      layersContent.forEach(text => {
        const layerDiv = document.createElement('div');
        layerDiv.className = 'text-layer';
        
        const textSpan = document.createElement('span');
        // The text needs to be duplicated for the seamless scroll effect
        textSpan.textContent = text + text; 
        
        layerDiv.appendChild(textSpan);
        textContainer.appendChild(layerDiv);
      });
    }

    window.addEventListener('load', () => {
      clearInterval(interval);
      loaderProgress.style.width = '100%';
      setTimeout(() => {
        loaderWrapper.style.opacity = '0';
        loaderWrapper.addEventListener('transitionend', () => {
          loaderWrapper.style.display = 'none';
          mainContent.classList.add('loaded');
          startApp();
          initHiraganaBackground();
        }, { once: true }); 
      }, 500); 
    });
  </script>

  <script src="assets/musicplayer.js"></script>
  <script src="assets/logo/logo_animation.js"></script>
</body>
</html>